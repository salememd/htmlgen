<html xml:lang="en-ly" lang="en-ly" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Libya Guide</title>

    <link type="text/css" rel="stylesheet" href="js/jui/jui-theme.css?v=1.1" />
    <link type="text/css" rel="stylesheet" href="css/style.css?v=1.1" />
    <link type="text/css" rel="stylesheet" href="css/en.css?v=1.1" />
    <link type="text/css" rel="stylesheet" href="tree.css?v=1.1" />
    <script src="js/jui/jui-core.js?v=1.1" type="text/javascript"></script>

    <script type="text/javascript">
        /* global app, webapp */

        var webapp = {


        };
        app.dir = "ltr";
        app.main = function() {
            new webapp.Administration();
        };
    </script>

    <script src="js/jui/jui-icons.js?v=1.1" type="text/javascript"></script>
    <script src="js/jui/jui-components.js?v=1.1" type="text/javascript"></script>
    <script src="js/jui/jui-window.js?v=1.1" type="text/javascript"></script>
    <script src="js/jui/extra-components/jui-components.js?v=1.1" type="text/javascript"></script>
    <script src="js/jui/jui-data.js?v=1.1" type="text/javascript"></script>

    <script>
        (function() {


            jUI.Tree = function(pa) {
                if (pa && pa.__loading__) return;
                var newPa = app.$(app.clone(pa), {
                    className: "jui tree",
                    visible: true
                }, false);
                var el = document.createElement("ul");

                jUI.DBComponent.call(this, newPa, el);
            };

            (function() {
                jUI.Tree.prototype = new jUI.DBComponent({
                    __loading__: true
                });
                jUI.Tree.prototype.constructor = jUI.Tree;


                // Overriden Function Start ===========================================

                jUI.Tree.prototype._initProp = function(pa) {
                    jUI.DBComponent.prototype._initProp.call(this, pa);
                    this.__V.Tree = {
                        rootNode: new jUI.Tree.Node({
                            text: "",
                            selectable: false,
                            children: [],
                            expanded: false,

                        })
                    }

                    this.setNoWrap(true);

                };

                jUI.Tree.prototype.leafs = function(nodes) {
                    var r = this.__V.Tree.rootNode;
                    r.addChild(nodes);
                    r.setExpanded(true);
                    r.__V.Node.expandDom.setVisible(false);
                    this.addChildren([r]);
                    for (var i = 0; i < nodes.length; i++) {
                        nodes[i]._setTree(this);
                    }
                };

                jUI.Tree.prototype._doDatasetRefresh = function(dataset) {
                    var ds = this.getDataset();
                    var fd = [];
                    var a = [];
                    var k;

                    for (var f in ds.getFields()) {
                        fd.push(f);
                    }

                    for (var i = 0; i < ds.getRecords().length; i++) {
                        k = 0;

                        (foo = function(set, p) {
                            if (k > fd.length - 1) {
                                return;
                            }
                            var flag = 0;
                            for (var j = 0; j < set.length; j++) {

                                if (set[j].getText() == ds.getFieldValueAt(fd[k], i)) {
                                    if (set[j].getChildren().length > 0) {
                                        k++;
                                        foo(set[j].getChildren(), set[j]);
                                        flag = 1;
                                    } else {
                                        k++;
                                        flag = 1;
                                    }
                                }

                            }

                            if (flag == 0) {
                                if (p == null) {

                                    var n = new jUI.Tree.Node({
                                        selectable: true,
                                        text: ds.getFieldValueAt(fd[k], i),
                                        children: [],
                                        expanded: true
                                    });
                                    k++;
                                    a.push(n);
                                    foo(n.getChildren(), n);

                                } else {
                                    var n = new jUI.Tree.Node({
                                        selectable: true,
                                        text: ds.getFieldValueAt(fd[k], i),
                                        children: [],
                                        expanded: true
                                    });

                                    p.addChild(n)
                                    k++;
                                    foo(n.getChildren(), n);

                                }
                            }
                        })(a, null);

                    }

                    // group, this can be removed subnodes will appear
                    a.forEach(function(e) {
                        var n = new jUI.Tree.Node({
                            selectable: true,
                            text: e.getChildren().length,
                            children: [],
                            expanded: true
                        });
                        e.removeChildren();
                        e.addChild(n);
                    });


                    this.leafs(a);
                };


                jUI.Tree.prototype.getTreeLeafs = function() {
                    return this.__V.Tree.rootNode.getChildren();
                };



                jUI.Tree.prototype.getSelectedNodes = function() {
                    return this.__V.Tree.rootNode._getSelectedChildren();
                };



                app.$(jUI.Tree.prototype.__props = app.clone(jUI.Tree.prototype.__props), {
                    leafs: "leafs"

                });

                jUI.Tree.prototype.__events = jUI.Tree.prototype.__events.clone().concat([
                    "onNodeSelectionChange",
                    "onViewStateChange"

                ]);

            })();
        })();



        /* 
		
		
		
		jUI Tree node 
		
		
		
		
		
		*/




        (function() {
            jUI.Tree.Node = function(pa) {
                if (pa && pa.__loading__) return;
                var newPa = app.$(app.clone(pa), {
                    className: "treenode",
                }, false);
                var el = document.createElement("li");

                jUI.Layout.call(this, newPa, el);
            };

            (function() {
                jUI.Tree.Node.prototype = new jUI.Layout({
                    __loading__: true
                });
                jUI.Tree.Node.prototype.constructor = jUI.Tree.Node;

                jUI.Tree.Node.prototype._initProp = function(pa) {
                    jUI.Layout.prototype._initProp.call(this, pa);

                    var container = new jUI.Layout({
                        visible: true,
                        layout: jUI.Layout.ltFollowVer,
                        parent: this,
                        noWrap: true
                    });

                    this.__V.Node = {

                        isExpanded: false,

                        isSelectable: false,

                        children: [],

                        treeObj: null,

                        parentNode: null,

                        expandDom: new jUI.Shape({
                            path: "",
                            visible: true,
                            layout: jUI.Layout.ltFollowHor,
                            width: 18,
                            height: 18,
                            classModifier: "expand",
                            parent: container
                        }),

                        selectDom: new jUI.Checkbox({
                            checked: false,
                            readOnly: false,
                            visible: false,
                            layout: jUI.Layout.ltFollowHor,
                            label: "",
                            classModifier: "selection",
                            parent: container,
                        }),

                        text: new jUI.Label({
                            classModifier: "nodetext",
                            text: "",
                            layout: jUI.Layout.ltFollowHor,
                            forId: "",
                            parent: container,
                        }),


                    };
                    this.setVisible(true);
                    this.setLayout(jUI.Layout.ltFollowVer);


                };


                jUI.Tree.Node.prototype.setText = function(text) {
                    this.__V.Node.text.setText(text);


                }

                jUI.Tree.Node.prototype.getText = function() {
                    return this.__V.Node.text.getText();

                }

                jUI.Tree.Node.prototype.getChildren = function() {
                    return this.__V.Node.children;

                }

                jUI.Tree.Node.prototype.removeChildren = function() {
                    this.__V.Node.children.forEach(function(element) {
                        element.finalize();
                    });
                    this.__V.Node.children = [];

                }


                jUI.Tree.Node.prototype._getSelectedChildren = function(node = this.getChildren(), set = []) {

                    for (var i = 0; i < node.length; i++) {
                        node[i]._getSelectedChildren(node[i].getChildren(), set);
                        if (node[i].__V.Node.selectDom.getChecked() == true && node[i].getChildren().length == 0) {
                            set.push(node[i]);
                        }
                    }
                    return set;
                };



                /**
                Collapse or expand the node
				
                **/

                jUI.Tree.Node.prototype.setExpanded = function(isExpanded) {
                    var n = this.__V.Node;
                    n.isExpanded = isExpanded;
                    if (this.getChildren().length > 0) {
                        if (isExpanded) {
                            n.expandDom.setPath(app.resources.icons.paths.treeExpand.path);
                            n.subnodeDom.setVisible(true);
                            n.isExpanded = isExpanded;


                        } else {
                            if (app.rtl) {
                                n.expandDom.setPath(app.resources.icons.paths.treeCollapsRTL.path);
                            } else {
                                n.expandDom.setPath(app.resources.icons.paths.treeCollaps.path);
                            }
                            n.subnodeDom.setVisible(false);
                            n.isExpanded = isExpanded;

                        }

                    }
                };


                /**
                select/unselect the node and all it's children	
				
				**/

                jUI.Tree.Node.prototype.setSelected = function(selected) {
                    if (this.__V.Node.selectDom.getChecked() != !selected)
                        this._setSelected(selected)

                };


                jUI.Tree.Node.prototype._setSelected = function(selected, node = this) {

                    var en = node.__V.Node;
                    var t = node.getChildren();

                    if (selected) {
                        en.selectDom.setChecked(true);
                        for (var i = 0; i < t.length; i++) {
                            if (t[i].__V.Node.selectDom.getChecked() == false) {
                                this._setSelected(true, t[i]);
                            }
                        }


                    } else {
                        en.selectDom.setChecked(false);
                        for (var i = 0; i < t.length; i++) {
                            if (t[i].__V.Node.selectDom.getChecked()) {
                                this._setSelected(false, t[i]);
                            }
                        }
                    }

                    var f = 0;
                    if (en.parentNode == null) {
                        return;
                    }
                    en.parentNode.getChildren().forEach(function(n) {
                        if (n.__V.Node.selectDom.getChecked() != selected) {
                            f = 1;
                            return;
                        }

                    });
                    if (f == 0) {
                        en.parentNode._setSelected(selected);
                    }
                };


                /**
                TreeView uses this method to reference its own object with the node to run events
				
                **/
                jUI.Tree.Node.prototype._setTree = function(tree) {
                    var n = this.__V.Node;

                    if (tree instanceof jUI.Tree) {
                        n.treeObj = tree;
                        for (var j = 0; j < n.children.length; j++) {
                            n.children[j]._setTree(tree);
                        }
                    }

                };




                jUI.Tree.Node.prototype.addChild = function(node) {
                    var n = this.__V.Node;
                    var childSet = [];

                    if (arguments.length > 1) {
                        childSet = arguments;

                    } else if (node instanceof Array) {
                        childSet = node;

                    } else if (node instanceof jUI.Tree.Node) {
                        childSet.push(node)

                    } else {
                        throw new Error("Uncomaptable");

                    }

                    if (childSet.length == 0) {
                        return;
                    }

                    for (var i = 0; i < childSet.length; i++) {
                        if (childSet[i] instanceof jUI.Tree.Node == false) {
                            throw new Error("Uncomaptable");
                        }
                        childSet[i].__V.Node.parentNode = this;
                    }


                    if (typeof this.__V.Node.subnodeDom !== "undefined") {
                        n.subnodeDom.addChildren(childSet);
                        n.children = n.children.concat(childSet);
                        return;
                    }

                    n.children = childSet;

                    var container = new jUI.Layout({
                        visible: true,
                        layout: jUI.Layout.ltFollowVer,
                        parent: this,
                        noWrap: true
                    });

                    var subnode = new jUI.Layout({
                        visible: true,
                        layout: jUI.Layout.ltFollowHor,
                        parent: container,
                    }, document.createElement("ul"));

                    var oj = this;

                    n.expandDom.setVisible(true);

                    n.expandDom.addEvents({
                        click: function() {
                            oj.setExpanded(!oj.__V.Node.isExpanded);
                            if (oj.__V.Node.treeObj != null)
                                oj.__V.Node.treeObj._doEvent("onViewStateChange", oj);
                        }
                    });

                    subnode.addChildren(childSet);

                    n.subnodeDom = subnode;

                    this.setExpanded(n.isExpanded);

                }


                /**
                control whether the node can be selected or not				
				
                **/
                jUI.Tree.Node.prototype.setSelectable = function(isSelectable) {
                    var n = this.__V.Node;
                    if (isSelectable == true && n.isSelectable == false) {
                        n.isSelectable = true;
                        var oj = this;

                        n.selectDom.addEvents({
                            check: function(state) {
                                oj._setSelected(state);
                                if (oj.__V.Node.treeObj != null)
                                    oj.__V.Node.treeObj._doEvent("onNodeSelectionChange", oj);
                            }
                        });
                        this.__V.Node.selectDom.setVisible(true);
                    } else if (isSelectable == false && n.isSelectable == true) {
                        n.selectDom.setVisible(false);
                        n.isSelectable = false;

                    }

                }



                app.$(jUI.Tree.Node.prototype.__props = app.clone(jUI.Tree.Node.prototype.__props), {
                    text: "setText",
                    children: "addChild",
                    expanded: "setExpanded",
                    selectable: "setSelectable",
                });

                jUI.Tree.Node.prototype.__events = jUI.Tree.Node.prototype.__events.clone().concat([

                ]);


            })();
        })();
    </script>

    <script src="js/webapp/views/test.js?v=1.1" type="text/javascript"></script>
</head>

<body onload="void(0);">
</body>

</html>